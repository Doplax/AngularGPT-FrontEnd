@if( originalImage() ){
  <div class="fixed flex flex-col items-center top-16 right-6 z-50 fade-in bg-[#2f2f2f] border border-gray-700 rounded-xl p-4 shadow-2xl">
    <span class="text-sm font-semibold mb-2">Editando</span>
    <img
      [src]="originalImage()"
      alt="Imagen a Editar"
      class="border border-gray-600 rounded-lg w-36 h-36 object-contain"
    />

    <button class="mt-3 px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white text-sm font-medium rounded-lg transition-all" (click)="generateVariation()">
      Generar variación
    </button>
  </div>
}

<div class="flex flex-col h-full bg-[#212121]">
  <!-- Messages Area -->
  <div class="flex-1 overflow-y-auto">
    <div class="max-w-4xl mx-auto px-4 py-8">
      <div class="space-y-0">
        <app-chat-message text="¿Qué deseas generar?" />

        @for (message of messages(); track $index) {
          @if (message.isGpt) {
            <app-gpt-message-editable-image
              [text]="message.text"
              [imageInfo]="message.imageInfo!"
              (onSelectedImage)="handleImageChange($event, message.imageInfo!.url)"
              />
          } @else {
            <app-my-message [text]="message.text" />
          }
        }
        @if(isLoading()) {
          <app-typing-loader />
        }
      </div>
    </div>
  </div>

  <!-- MessageBox - Fixed at bottom -->
  <div class="flex-shrink-0 border-t border-gray-800 bg-gradient-to-b from-[#212121] to-[#0f0f0f] pt-3 pb-6">
    <div class="max-w-4xl mx-auto px-4">
      <app-text-message-box
        placeHolder="Describe la imagen que deseas generar"
        (onMessage)="handleMessage($event)"
      />
      <p class="text-center text-xs text-gray-500 mt-3 px-2">
        AngularGPT puede cometer errores. Considera verificar información importante.
      </p>
    </div>
  </div>
</div>
